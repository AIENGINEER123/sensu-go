# Usage

## Generate Types

Describe new type definition(s):

```graphql
# ./backend/apid/graphql/schema/dog.graphql

"""
A Dog is a wonderful animal
"""
type Dog implements Named {
  name: String
  profilePicture(size: Size): String
  friends: [Pet]!
}

input Size {
  width: Int
  height: Int
  density: float
}
```

Next you'll want to generate the Go code for these new types. To do this we use
the `gengraphql` script.

From the project root, run:

```shell
go run ./scripts/gengraphql.go ./backend/apid/graphql/schema
```

Next we need to tell our service how the types themselves are implemented. To
give an example, when a user selects a dog's friends, the service needs to know
_how_ to retrieve those details so that it can display them to the user.

An example implementation:

```go
// backend/apid/graphql/dog.go

type dogFieldResolvers struct {
  // the autogenerated "aliases" use reflection under the hood to implement most
  // most the field resolvers; this allows us to write a bit less code with a
  // small runtime cost.
  *schema.DogAliases

  controller FriendsController
  logger     logrus.Entry
}

// Use controller to retrieve our dog's friends.
func (fr *dogFieldResolvers) Friends(p graphql.ResolveParams) (interface{}, error) {
  dog := p.Source.(*types.Dog)
  ctx := p.Context
  friends, err := fr.controller.ListFriendos(ctx, dog)
  return friends, err
}

// IsTypeOf is used to determine if a given value is associated with the Dog type
func (fr *dogFieldResolvers) IsTypeOf(s interface{}, p graphql.IsTypeOfParams) bool {
  _, ok := s.(*types.Dog)
  return ok
}
```

Finally we need to register the new type(s) and any of the implementation
details with our service.

```go
// backend/apid/graphql/service.go

fund NewService(c Config) *Service {
  // ...
  dogImpl := dogFieldResolvers{controller: ..., logger: ...}
  // ...

  // ...
  schema.RegisterDog(svc, dogImpl) // include fieldresolvers.
  schema.RegisterSize(svc)         // unlike object type's inputs do not require any additonal implemtation details.
  // ...

  // configures registered types and implementations so that service is ready to
  // accept queries.
  service.Reconfigure()
  return service
}
```

## Relevant Material

Example of expected output: backend/apid/graphqlschema/event.go
Example of code generator: backend/apid/graphql/generator/scalar.go
Reference for code generator library: https://github.com/dave/jennifer
Example schema: backend/apid/graphql/schema/schema-kitchen-sink.graphql
